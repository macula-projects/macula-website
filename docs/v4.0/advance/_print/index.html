<!doctype html><html lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><link rel=canonical type=text/html href=/docs/v4.0/advance/><link rel=alternate type=application/rss+xml href=/docs/v4.0/advance/index.xml><meta name=robots content="noindex, nofollow"><link rel=icon href=/favicons/favicon.ico><title>高级实战 | Macula</title><meta name=description content="本章介绍Macula的高级特性，主要用在大规模生产环境"><meta property="og:title" content="高级实战"><meta property="og:description" content="本章介绍Macula的高级特性，主要用在大规模生产环境"><meta property="og:type" content="website"><meta property="og:url" content="/docs/v4.0/advance/"><meta property="og:site_name" content="Macula"><meta itemprop=name content="高级实战"><meta itemprop=description content="本章介绍Macula的高级特性，主要用在大规模生产环境"><meta name=twitter:card content="summary"><meta name=twitter:title content="高级实战"><meta name=twitter:description content="本章介绍Macula的高级特性，主要用在大规模生产环境"><link rel=preload href=/scss/main.min.56f91794193debaacc9fed9f3ea1305973c18c460520344068f08ae5f95e5027.css as=style><link href=/scss/main.min.56f91794193debaacc9fed9f3ea1305973c18c460520344068f08ae5f95e5027.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/><span>首页</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/project><span>项目</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=http://14.22.2.220:80/#/login target=_blank><span>体验版</span></a></li></ul></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/v4.0/advance/>返回本页常规视图</a>.</p></div><h1 class=title>高级实战</h1><div class=lead>本章介绍Macula的高级特性，主要用在大规模生产环境</div><ul><li>1: <a href=#pg-e5ff9e9ca09c76df01c15478dfa54016>Dubbo：高性能 RPC 分布式服务框架</a></li><li>2: <a href=#pg-0a8c4f3983bed392d337a4479fcb69d7>Gateway ..</a></li><li>3: <a href=#pg-7664d496dfe7c405292f1de3090f94f9>Nacos : 动态服务发现、配置管理平台</a></li><li>4: <a href=#pg-62f7970416704a72537429c628418e82>Oauth2 ..</a></li><li>5: <a href=#pg-d5a53c4ca4d1aba3f748363aabb9249e>Power Job: 统一调度平台</a></li><li>6: <a href=#pg-00034351b355c12d02118bdb2bf40244>RocketMQ ..</a></li><li>7: <a href=#pg-38057557f3d7dc9cb3da9f3f27668dff>Seata ..</a></li><li>8: <a href=#pg-3787e47c24f406f12f6247a74a39e462>Sentinel ：分布式系统的流量防卫兵</a></li></ul><div class=content><h1 id=高级实战><strong>高级实战</strong></h1><p>本章介绍Macula的高级特性，主要用在大规模生产环境</p></div></div><div class=td-content><h1 id=pg-e5ff9e9ca09c76df01c15478dfa54016>1 - Dubbo：高性能 RPC 分布式服务框架</h1><div class=lead>Dubbo是阿里巴巴开源的基于 Java 的高性能 RPC（一种远程调用） 分布式服务框架（SOA），致力于提供高性能和透明化的RPC远程服务调用方案，以及SOA服务治理方案。Macula 架构使用 Dubbo Spring Cloud 为组件模块，项目中引入 macula-cloud-dubbo 便可直接用于分布式服务的使用。</div><h3 id=dubbo-spring-cloud-主要特性>Dubbo Spring Cloud 主要特性</h3><ul><li>面向接口代理的高性能RPC调用：提供高性能的基于代理的远程调用能力，服务以接口为粒度，屏蔽了远程调用底层细节。</li><li>智能负载均衡：内置多种负载均衡策略，智能感知下游节点健康状况，显著减少调用延迟，提高系统吞吐量。</li><li>服务自动注册与发现：支持多种注册中心服务，服务实例上下线实时感知。</li><li>高度可扩展能力：遵循微内核+插件的设计原则，所有核心能力如Protocol、Transport、Serialization被设计为扩展点，平等对待内置实现和第三方实现。</li><li>运行期流量调度：内置条件、脚本等路由策略，通过配置不同的路由规则，轻松实现灰度发布，同机房优先等功能。</li><li>可视化的服务治理与运维：提供丰富服务治理、运维工具：随时查询服务元数据、服务健康状态及调用统计，实时下发路由策略、调整配置参数。</li></ul><h3 id=heading></h3><h3 id=quick-start><strong>Quick Start.</strong></h3><ol><li><strong>创建父工程demo-member</strong></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;project</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style=color:#c4a000>xmlns:xsi=</span><span style=color:#4e9a06>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#c4a000>xsi:schemaLocation=</span><span style=color:#4e9a06>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;modelVersion&gt;</span>4.0.0<span style=color:#204a87;font-weight:700>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.macula.base<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>demo-member<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>4.0.0-SNAPSHOT<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;packaging&gt;</span>pom<span style=color:#204a87;font-weight:700>&lt;/packaging&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;modules&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;module&gt;</span>demo-member-infra<span style=color:#204a87;font-weight:700>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;module&gt;</span>demo-member-admin<span style=color:#204a87;font-weight:700>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;module&gt;</span>demo-member-esb-api<span style=color:#204a87;font-weight:700>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;module&gt;</span>demo-member-esb-api-impl<span style=color:#204a87;font-weight:700>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/modules&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/project&gt;</span>
</span></span></code></pre></div><p>总项目中 modules 说明：
<strong>demo-member-infra</strong> :基础对象公共模块，存放对象实体类, Repostory, 公共服务类等。</p><p><strong>demo-member-admin</strong> :管理端接口，本地服务接口调用。</p><p><strong>demo-member-esb-api</strong> :Dubbo Api 定义。</p><p><strong>demo-member-esb-api-impl</strong> :dubbo与rest服务供应商， Dubbo Api 的实现。</p><ol start=2><li><strong>子模块demo-member-esb-api</strong></li></ol><p>API模块，存放Dubbo服务接口和模型定义，非必要，这里创建仅为更好的代码重用以及接口、模型规格控制管理。</p><p>定义抽象接口UserApi.java：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.macula.base.api</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.macula.base.vo.UserVo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>UserApi</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   * 根据userName 获取用户
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#000>UserVo</span> <span style=color:#000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   * 保存用户信息
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UserVo</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ol start=3><li><strong>子模块 demo-member-esb-api-impl Dubbo服务提供方</strong></li></ol><p>pom.xml 依赖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>parent</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>maculaframework</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>macula</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>parent</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#0000cf;font-weight:700>4.0.0</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>SNAPSHOT</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>relativePath</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>parent</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;!--</span> <span style=color:#000>Dubbo</span> <span style=color:#a40000>使用相关依赖</span> <span style=color:#ce5c00;font-weight:700>--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>maculaframework</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>macula</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>cloud</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>dubbo</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;!--</span> <span style=color:#000>nacos</span> <span style=color:#a40000>注册中心相关依赖</span> <span style=color:#ce5c00;font-weight:700>--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>maculaframework</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>macula</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>cloud</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>nacos</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;!--</span><span style=color:#a40000>实现</span> <span style=color:#000>demo</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>api</span> <span style=color:#a40000>模块</span> <span style=color:#ce5c00;font-weight:700>--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>macula</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>base</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>demo</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>member</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>esb</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>api</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>$</span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>revision</span><span style=color:#ce5c00;font-weight:700>}&lt;/</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;!--</span> <span style=color:#a40000>公共模块依赖</span> <span style=color:#ce5c00;font-weight:700>--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>macula</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>base</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>demo</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>member</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>infra</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>$</span><span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>revision</span><span style=color:#ce5c00;font-weight:700>}&lt;/</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>scope</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>compile</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>scope</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>此处引入公共模块，API模块, 架构dubbo模块 等依赖。
实现Dubbo接口，UserApiImpl.java如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.macula.base.api</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.apache.dubbo.config.annotation.DubboService</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.macula.base.member.domain.UserDemoEntity</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.macula.base.member.repository.UserDemoRepository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.macula.base.vo.UserVo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.springframework.beans.BeanUtils</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.springframework.beans.factory.annotation.Autowired</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.springframework.util.Assert</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>javax.ws.rs.*</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>javax.ws.rs.core.MediaType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>org.springframework.util.MimeTypeUtils.APPLICATION_JSON_VALUE</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@DubboService</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>protocol</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;dubbo&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;rest&#34;</span><span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Path</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/user&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>UserApiImpl</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>UserApi</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>UserDemoRepository</span> <span style=color:#000>userDemoRepository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Path</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;get&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@GET</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Produces</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>APPLICATION_JSON_VALUE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Consumes</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>MediaType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>APPLICATION_JSON</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>UserVo</span> <span style=color:#000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@QueryParam</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userName&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Assert</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>hasLength</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;macula.get.user.userName.notBlank&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>UserDemoEntity</span> <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>userDemoRepository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findByUserName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>convert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Path</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;save&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@POST</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@Produces</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>APPLICATION_JSON_VALUE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UserVo</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Assert</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>notNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;macula.sync.user.notNull&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>UserDemoEntity</span> <span style=color:#000>currentUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>userDemoRepository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findByUserName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#000>UserDemoEntity</span> <span style=color:#000>newUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>convert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentUser</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>BeanUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>copyProperties</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>newUser</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>currentUser</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userDemoRepository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentUser</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userDemoRepository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>newUser</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>UserVo</span> <span style=color:#000>convert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UserDemoEntity</span> <span style=color:#000>userEntity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>UserVo</span> <span style=color:#000>userVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>UserVo</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BeanUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>copyProperties</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>userEntity</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>UserDemoEntity</span> <span style=color:#000>convert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UserVo</span> <span style=color:#000>userVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>UserDemoEntity</span> <span style=color:#000>userEntity</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>UserDemoEntity</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>BeanUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>copyProperties</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>userVO</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userEntity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userEntity</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>@DubboService 声明了Dubbo请求 与Rest请求 两种模式， @Path("/user") 为 rest 请求路径地址，结合方法路径上的 @Path(&ldquo;get&rdquo;) 发送 http 使用。
配置文件 application.yml 需要将Java服务（本地）配置为 Dubbo 服务（远程）如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## 服务发现与注册配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spring</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cloud</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nacos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>discovery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>server-addr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.url}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.namespace}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.username}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.password}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>###########dubbo配置###############</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>dubbo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>application</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${spring.application.name}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scan</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># dubbo 服务扫描基准包</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>base-packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.macula.base.api</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>protocols</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dubbo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># dubbo 协议</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dubbo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># dubbo 协议端口（ -1 表示自增端口，从 20880 开始）</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>threads</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>500</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>rest</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># http rest 请求 </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>9090</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>server</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>netty</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>macula</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># 挂载到 Spring Cloud 注册中心</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nacos://${macula.nacos.registry.url}?namespace=${macula.nacos.namespace}&amp;username=${macula.nacos.username}&amp;password=${macula.nacos.password}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li><code>dubbo.scan.base-packages</code>：指定 Dubbo 服务实现类的扫描基准包</li><li><code>dubbo.protocols</code>：<ul><li>name: dubbo 为 Dubbo服务暴露的协议配置，其中子属性name为协议名称，port为协议端口（-1 表示自增端口，从 20880 开始）</li><li>name: rest 为http协议，server：netty 为应用启动容器服务</li></ul></li><li><code>dubbo.registries</code>：<ul><li>macula: default true 为 Dubbo 服务默认注册中心配置，其中子属性address 的值 &ldquo;nacos://${macula.nacos.registry.url}"，说明挂载到 Nacos 注册中心。</li></ul></li><li><code>dubbo.application.name</code>：dubbo服务名称</li><li><code>spring.cloud.nacos.discovery</code>：Nacos 服务发现与注册配置，其中子属性 server-addr 指定 Nacos 服务器主机和端口。</li></ul><p>创建服务启动类</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@DubboComponentScan</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@EnableDiscoveryClient</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MemberEsbDubboApplication</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SpringApplication</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>MemberEsbDubboApplication</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ol start=4><li><strong>子模块 demo-member-admin 服务调用方</strong></li></ol><p>工程依赖 pom.xml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.macula.base<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>demo-member-esb-api<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>${revision}<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>配置文件 application.yml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## 服务发现与注册配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spring</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cloud</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nacos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>discovery</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>server-addr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.url}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.namespace}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.username}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.password}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>dubbo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>scan</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># dubbo 服务扫描基准包</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>base-packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.macula.base.api</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cloud</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># The subscribed services in consumer side</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>subscribed-services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${provider.application.name}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>protocols</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dubbo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>consumer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>registries</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>macula</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>address</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nacos://${macula.nacos.registry.url}?namespace=${macula.nacos.namespace}&amp;username=${macula.nacos.username}&amp;password=${macula.nacos.password}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>timeout</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>60000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>测试接口HelloController.java</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>HelloController</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@DubboReference</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>UserApi</span> <span style=color:#000>userApi</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>String</span> <span style=color:#000>BASE_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://localhost:9090&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 通过Dubbo协议请求
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#5c35cc;font-weight:700>@GetMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/testDubbo&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>testDubbo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userApi</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 通过Http Rest 请求
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#5c35cc;font-weight:700>@GetMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/testRest&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testRest</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>String</span> <span style=color:#000>uri</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/user/get?userName=admin&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 发起请求
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>OkHttpClient</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>OkHttpClient</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Request</span> <span style=color:#000>request</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Request</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Builder</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>url</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BASE_URL</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>uri</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Response</span> <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>client</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newCall</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;请求结果: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>body</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>string</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>IOException</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0a8c4f3983bed392d337a4479fcb69d7>2 - Gateway ..</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-7664d496dfe7c405292f1de3090f94f9>3 - Nacos : 动态服务发现、配置管理平台</h1><div class=lead>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台.</div><h3 id=什么是-nacos->什么是 Nacos ?</h3><blockquote><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理
Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施</p></blockquote><ul><li><strong>服务发现和服务健康监测</strong></li></ul><blockquote><p>Nacos 支持基于 DNS 和基于 RPC 的服务发现。服务提供者使用 <a href=https://nacos.io/zh-cn/docs/sdk.html>原生SDK</a>、<a href=https://nacos.io/zh-cn/docs/open-api.html>OpenAPI</a>、或一个<a href=https://nacos.io/zh-cn/docs/other-language.html>独立的Agent TODO</a>注册 Service 后，服务消费者可以使用<a href=https://nacos.io/zh-cn/docs/xx>DNS TODO</a> 或<a href=https://nacos.io/zh-cn/docs/open-api.html>HTTP&amp;API</a>查找和发现服务。
Nacos 提供对服务的实时的健康检查，阻止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。Nacos 还提供了统一的健康检查仪表盘，帮助您根据健康状态管理服务的可用性及流量。</p></blockquote><ul><li><strong>动态配置服务</strong></li></ul><blockquote><p>动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。
动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。
配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。
Nacos 提供了一个简洁易用的UI (<a href=http://console.nacos.io/nacos/index.html>控制台样例 Demo</a>) 帮助您管理所有的服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助您更安全地在生产环境中管理配置变更和降低配置变更带来的风险。</p></blockquote><ul><li><strong>动态 DNS 服务</strong></li></ul><blockquote><p>动态 DNS 服务支持权重路由，让您更容易地实现中间层负载均衡、更灵活的路由策略、流量控制以及数据中心内网的简单DNS解析服务。动态DNS服务还能让您更容易地实现以 DNS 协议为基础的服务发现，以帮助您消除耦合到厂商私有服务发现 API 上的风险。
Nacos 提供了一些简单的 <a href=https://nacos.io/zh-cn/docs/xx>DNS APIs TODO</a> 帮助您管理服务的关联域名和可用的 IP:PORT 列表.</p></blockquote><ul><li><strong>服务及其元数据管理</strong></li></ul><blockquote><p>Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。</p></blockquote><h4 id=nacos-地图>Nacos 地图</h4><p>一图看懂 Nacos.</p><p><a data-fancybox=gallery href=/docs/imgs/v4/Nacos1.png><img src=/docs/imgs/v4/Nacos1.png alt=图片></a></p><ul><li><strong>特性大图</strong>：要从功能特性，非功能特性，全面介绍我们要解的问题域的特性诉求</li><li><strong>架构大图</strong>：通过清晰架构，让您快速进入 Nacos 世界</li><li><strong>业务大图</strong>：利用当前特性可以支持的业务场景，及其最佳实践</li><li><strong>生态大图</strong>：系统梳理 Nacos 和主流技术生态的关系</li><li><strong>优势大图</strong>：展示 Nacos 核心竞争力</li><li><strong>战略大图</strong>：要从战略到战术层面讲 Nacos 的宏观优势</li></ul><h4 id=nacos-生态><strong>Nacos 生态</strong></h4><p><a data-fancybox=gallery href=/docs/imgs/v4/Nacos2.png><img src=/docs/imgs/v4/Nacos2.png alt=图片></a></p><p>如 Nacos 全景图所示，Nacos 无缝支持一些主流的开源生态，例如</p><ul><li><a href=https://nacos.io/en-us/docs/quick-start-spring-cloud.html>Spring Cloud</a></li><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html>Apache Dubbo and Dubbo Mesh</a></li><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-kubernetes.html>Kubernetes and CNCF</a></li></ul><p>使用 Nacos 简化服务发现、配置管理、服务治理及管理的解决方案，让微服务的发现、管理、共享、组合更加容易。</p><p>关于如何在这些生态中使用 Nacos，请参考以下文档：</p><ul><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-springcloud.html>Nacos与Spring Cloud一起使用</a></li><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-kubernetes.html>Nacos与Kubernetes一起使用</a></li><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html>Nacos与Dubbo一起使用</a></li><li><a href=https://nacos.io/zh-cn/docs/roadmap.html>Nacos与gRPC一起使用</a></li><li><a href=https://nacos.io/zh-cn/docs/use-nacos-with-istio.html>Nacos与Istio一起使用</a></li></ul><h3 id=quick-start><strong>Quick Start</strong></h3><p>在 Springboot项目中使用 Nacos.</p><h4 id=step--1---添加依赖><strong>STEP 1. 添加依赖</strong></h4><p>在应用 pom.xml 中 加入以下代码即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;parent&gt;
</span></span><span style=display:flex><span>    &lt;groupId&gt;org.maculaframework&lt;/groupId&gt;
</span></span><span style=display:flex><span>    &lt;artifactId&gt;macula-parent&lt;/artifactId&gt;
</span></span><span style=display:flex><span>    &lt;version&gt;4.0.0-SNAPSHOT&lt;/version&gt;
</span></span><span style=display:flex><span>    &lt;relativePath/&gt;
</span></span><span style=display:flex><span>&lt;/parent&gt;
</span></span><span style=display:flex><span>&lt;!-- nacos 相关依赖 --&gt;
</span></span><span style=display:flex><span>&lt;dependency&gt;
</span></span><span style=display:flex><span>    &lt;groupId&gt;org.maculaframework&lt;/groupId&gt;
</span></span><span style=display:flex><span>    &lt;artifactId&gt;macula-cloud-nacos&lt;/artifactId&gt;
</span></span><span style=display:flex><span>&lt;/dependency&gt;
</span></span></code></pre></div><p><strong>macula-cloud-nacos 集成了 nacos 配置中心 ， 以及 服务注册/发现等 组件功能， 可根据需要 ，使用 nacos 提供的服务</strong></p><h4 id=step--2--使用案例><strong>STEP 2. 使用案例</strong></h4><p><strong>Nacos 作为 配置中心示例：</strong></p><p>基于 nacos 的 配置中心 应用配置</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>spring</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># nacos 配置中心相关配置  </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cloud</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nacos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>config</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 配置文件 后缀格式， 比如.yaml、 .properties  </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>file-extension</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>yaml </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 配置中心地址</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>server-addr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.url}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 配置所在空间 比如 Macula</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.namespace}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 配置中心 用户验证 </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.username}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${macula.nacos.password}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># 扩展配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>extension-configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>data-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>xxxxx.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>refresh</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spring</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>profiles</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dev</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>macula</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>nacos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://127.0.0.1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>username</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>macula</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>password</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>macula123</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MACULA-DEV</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Nacos 配置中心具体</strong>：<a href=README.md:216>请查看前几章 Nacos 配置中心应用配置文件</a></p><p><a data-fancybox=gallery href=/docs/imgs/v4/Nacos3.png><img src=/docs/imgs/v4/Nacos3.png alt=图片></a></p><p><strong>Nacos 作为 注册中心</strong></p><p>配置文件中， 配置 Nacos 配置中心地址</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>spring:
</span></span><span style=display:flex><span>  application:
</span></span><span style=display:flex><span>    name: pf-recruit // 设置项目名称
</span></span><span style=display:flex><span>  cloud:
</span></span><span style=display:flex><span>    nacos:
</span></span><span style=display:flex><span>      discovery:
</span></span><span style=display:flex><span>        server-addr: localhost:8848 // Nacos服务接口(不能加http前缀)，直接访问localhost:8848/nacos可以进入管理页面
</span></span></code></pre></div><p>启动类中开启服务发现.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@EnableDiscoveryClient</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>RecruitApplication</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SpringApplication</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RecruitApplication</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>以上就是 Nacos 全部内容</p></div><div class=td-content style=page-break-before:always><h1 id=pg-62f7970416704a72537429c628418e82>4 - Oauth2 ..</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-d5a53c4ca4d1aba3f748363aabb9249e>5 - Power Job: 统一调度平台</h1><div class=lead>Power Job是统一调度平台重要的一个应用任务代理，主要调度 gbss 相关的作业，比如数据同步、消息推送、群组、报表等。统一调度平台，是按应用进行作业分配和负载均衡的。</div><h3 id=powerjob特性>Power Job特性：</h3><p>1、采用quartz进行定时任务的发起</p><p>2、采用rabbitmq进行调度平台与应用方的通信</p><p>3、架构图：</p><p><a data-fancybox=gallery href=/docs/imgs/v4/Batch1.png><img src=/docs/imgs/v4/Batch1.png alt=图片></a></p><h3 id=power-job实现步骤>Power Job实现步骤：</h3><p>1、处理任务的应用通过agent注册进入Power Job平台</p><p>2、应用注册进入平台的appId与进行消息沟通rabbitmq的queue一一对应</p><p>3、在Power Job平台进行主动或定时任务的创建</p><p>4、Power Job平台主动或通过quartz定时任务发起任务处理消息</p><p>5、接入应用根据消息进行处理后进行结果应答</p><h3 id=应用方接入power-job案例>应用方接入Power Job案例</h3><h4 id=1接入power-job客户端依赖>1、接入Power Job客户端依赖</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>&lt;!-- applicationContext-root 配置 batch agent 信息 --&gt;
</span></span><span style=display:flex><span>&lt;!-- Macula Batch Agent --&gt;
</span></span><span style=display:flex><span>&lt;dependency&gt;
</span></span><span style=display:flex><span>     &lt;groupId&gt;org.macula.batch&lt;/groupId&gt;
</span></span><span style=display:flex><span>     &lt;artifactId&gt;macula-batch-jobtracker&lt;/artifactId&gt;
</span></span><span style=display:flex><span>     &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;
</span></span><span style=display:flex><span>&lt;/dependency&gt;
</span></span></code></pre></div><h4 id=2相关配置>2、相关配置</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>&lt;!-- Batch Agent(DEV) --&gt;
</span></span><span style=display:flex><span>&lt;bean id=&#34;agent&#34; class=&#34;org.macula.batch.jobtracker.domain.Agent&#34;&gt;
</span></span><span style=display:flex><span>     &lt;property name=&#34;serverUrl&#34; value=&#34;https://batch-test.infinitus.com.cn/admin/macula-batch&#34;&gt;&lt;/property&gt;
</span></span><span style=display:flex><span>     &lt;property name=&#34;appId&#34; value=&#34;gbss.po.dev&#34;&gt;&lt;/property&gt;
</span></span><span style=display:flex><span>     &lt;property name=&#34;appKey&#34; value=&#34;xxxxx&#34;&gt;&lt;/property&gt;
</span></span><span style=display:flex><span>     &lt;property name=&#34;taskTypes&#34; value=&#34;JAVA&#34;&gt;&lt;/property&gt;
</span></span><span style=display:flex><span>&lt;/bean&gt;
</span></span><span style=display:flex><span>&lt;!-- 相关bean注入 --&gt;
</span></span><span style=display:flex><span>&lt;context:component-scan base-package=&#34;com.infinitus.xxx.xx.xxx&#34; /&gt;
</span></span><span style=display:flex><span>&lt;!-- 任务执行代理 --&gt;
</span></span><span style=display:flex><span>&lt;import resource=&#34;classpath*:META-INF/spring/macula-batch-jobtracker.xml&#34; /&gt;
</span></span><span style=display:flex><span>&lt;!-- 任务消息扫描频率 --&gt;
</span></span><span style=display:flex><span>&lt;task:scheduled-tasks&gt;
</span></span><span style=display:flex><span>    &lt;task:scheduled ref=&#34;agentService&#34; method=&#34;listen&#34;  fixed-rate=&#34;5000&#34; /&gt;
</span></span><span style=display:flex><span>    &lt;task:scheduled ref=&#34;agentService&#34; method=&#34;ping&#34;   fixed-rate=&#34;10000&#34; /&gt;
</span></span><span style=display:flex><span>&lt;/task:scheduled-tasks&gt;
</span></span></code></pre></div><h4 id=3任务执行类>3、任务执行类</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>@Component(&#34;BatchTestTask&#34;)
</span></span><span style=display:flex><span>public class BatchTestTask extends AbstractBeanTask {
</span></span><span style=display:flex><span>  /**
</span></span><span style=display:flex><span>   * 任务核心执行代码
</span></span><span style=display:flex><span>   */
</span></span><span style=display:flex><span>  @Override
</span></span><span style=display:flex><span>  public void execute() throws Exception {
</span></span><span style=display:flex><span>    System.out.println(&#34;执行开始:&#34;+ System.currentTimeMillis());
</span></span><span style=display:flex><span>    //...
</span></span><span style=display:flex><span>    System.out.println(&#34;执行结束:&#34;+ System.currentTimeMillis());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>重要！！！</strong></p><blockquote><p>请保证应用运行环境为 1.7.0 及以上。( JAVA 1.6环境不支持 )</p></blockquote><h3 id=power-job管理配置案例>Power Job管理配置案例</h3><p><a data-fancybox=gallery href=/docs/imgs/v4/Batch2.png><img src=/docs/imgs/v4/Batch2.png alt=图片></a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-00034351b355c12d02118bdb2bf40244>6 - RocketMQ ..</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-38057557f3d7dc9cb3da9f3f27668dff>7 - Seata ..</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-3787e47c24f406f12f6247a74a39e462>8 - Sentinel ：分布式系统的流量防卫兵</h1><h3 id=sentinel-是什么>Sentinel 是什么？</h3><p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p><h4 id=sentinel-具有以下特征>Sentinel 具有以下特征:</h4><p><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</p><p><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p><p><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Apache Dubbo、gRPC、Quarkus 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。同时 Sentinel 提供 Java/Go/C++ 等多语言的原生实现。</p><p><strong>完善的 SPI 扩展机制</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</p><h4 id=sentinel-主要特性><strong>Sentinel 主要特性：</strong></h4><p><a data-fancybox=gallery href=/docs/imgs/v4/Sentinel1.png><img src=/docs/imgs/v4/Sentinel1.png alt=图片></a></p><h4 id=sentinel-开源生态><strong>Sentinel 开源生态:</strong></h4><p><a data-fancybox=gallery href=/docs/imgs/v4/Sentinel2.png><img src=/docs/imgs/v4/Sentinel2.png alt=图片></a></p><h3 id=quick-start><strong>Quick Start.</strong></h3><h4 id=step-1--添加依赖><strong>STEP 1. 添加依赖</strong></h4><p>在应用 pom.xml 中 加入以下代码即可：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>macula</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>plugins</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>groupId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>macula</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>plugins</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>sgs</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>artifactId</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#0000cf;font-weight:700>3.1.3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RELEASE</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>dependency</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>如果未使用依赖管理工具，请自行去公司 <strong>Maven Center Repository</strong> 下载 JAR 包   </p><p><strong>已知问题</strong> macula-plugins-sgs 中引入了 nacos-client 版本与公司部署的Nacos 兼容有问题</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>check</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>get</span> <span style=color:#000>changed</span> <span style=color:#000>dataId</span> <span style=color:#000>error</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>403</span>
</span></span></code></pre></div><p>建议 排除掉 macula-plugins-sgs中的 nacos-client ， 手动引入 nacos-client 1.4.0 以上版本</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain><span style=display:flex><span>&lt;dependency&gt;
</span></span><span style=display:flex><span>    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
</span></span><span style=display:flex><span>    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
</span></span><span style=display:flex><span>    &lt;version&gt;1.4.0&lt;/version&gt;
</span></span><span style=display:flex><span>&lt;/dependency&gt;
</span></span><span style=display:flex><span>&lt;dependency&gt;
</span></span><span style=display:flex><span>    &lt;groupId&gt;org.macula.plugins&lt;/groupId&gt;
</span></span><span style=display:flex><span>    &lt;artifactId&gt;macula-plugins-sgs&lt;/artifactId&gt;
</span></span><span style=display:flex><span>    &lt;version&gt;3.1.3.RELEASE&lt;/version&gt;
</span></span><span style=display:flex><span>    &lt;exclusions&gt;
</span></span><span style=display:flex><span>        &lt;exclusion&gt;
</span></span><span style=display:flex><span>            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
</span></span><span style=display:flex><span>            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
</span></span><span style=display:flex><span>        &lt;/exclusion&gt;
</span></span><span style=display:flex><span>    &lt;/exclusions&gt;
</span></span><span style=display:flex><span>&lt;/dependency&gt;
</span></span></code></pre></div><h4 id=step-2--添加配置><strong>STEP 2. 添加配置</strong></h4><p>目前sentinel 已集成 nacos 存储流控规则，实现流控规则双向推拉</p><p><strong>构建 NacosSubscriber</strong></p><ul><li><strong>TransportConfig.CONSOLE_SERVER</strong> 配置 sentinel 控制台地址, 注册客户端信息</li><li><strong>NacosSubscriber</strong> 构造方法, 配置Nacos地址信息， 用于订阅 ，存储Sentinel 流控规则, 项目启动时自动注册规则信息</li><li>构造参数信息<ul><li><strong>serverAddr</strong> Nacos 配置中心地址</li><li><strong>namespace</strong> Nacos 配置中心空间名 ， 默认 ： SENTINEL</li><li><strong>username</strong> Nacos 配置中心登陆账号</li><li><strong>password</strong> Nacos 配置中心登陆密码</li><li><strong>groupId</strong> Nacos 配置分组 ， 默认 SENTINEL_GROUP</li><li><strong>appName</strong> 应用Name, 框架内部基于 appName + 指定后缀名 构建 唯一流控规则配置名.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>NacosSubscriber</span> <span style=color:#000>nacosSubscriber</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// 配置 Sentinel Dashboard 控制台地址, 注意:无需HTTP协议前缀
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setProperty</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TransportConfig</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>CONSOLE_SERVER</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ss-dev.infinitus.com.cn&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// nacos 配置需 IP：port 或 domain:port 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// example should like ip:port or domain:port
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>NacosSubscriber</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;nacos-dev.infinitsu.com.cn:80&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;SENTIENL&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;nacos&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;nacosxxxx123&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;SENTINEL_GROUP&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;esb-demo&#34;</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>以上就是 流控系统接入 的内容 ， 实测 <strong>Dubbo</strong> 系统 接入 ok .
<strong>Web端 需额外添加配置 过滤web请求</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ConditionalOnBean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>NacosSubscriber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>FilterRegistrationBean</span> <span style=color:#000>sentinelFilterRegistration</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#000>FilterRegistrationBean</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Filter</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>registration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FilterRegistrationBean</span><span style=color:#ce5c00;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#000>registration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFilter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>CommonFilter</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#000>registration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addUrlPatterns</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/*&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#000>registration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;sentinelFilter&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#000>registration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setOrder</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#a40000> </span> <span style=color:#a40000> </span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>registration</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=step-3--启动项目><strong>STEP 3. 启动项目</strong></h4><p><strong>应用启动以后， 请求接口， 将在控制台显示请求数据</strong></p><p><strong>Sentinel 控制台</strong>：https://sgs-dev.infinitus.com.cn</p><p><a data-fancybox=gallery href=/docs/imgs/v4/Sentinel3.png><img src=/docs/imgs/v4/Sentinel3.png alt=Sentinel3.png></a></p><p><strong>通过配置流控规则 ，自动同步到Nacos 配置中心， 实现规则持久化，修改配置中心规则同样将反向推送到Sentinel</strong></p><p><a data-fancybox=gallery href=/docs/imgs/v4/Sentinel4.png><img src=/docs/imgs/v4/Sentinel4.png alt=图片></a></p><p><a data-fancybox=gallery href=/docs/imgs/v4/Sentinel5.png><img src=/docs/imgs/v4/Sentinel5.png alt=图片></a></p></div></main></div></div><script src=/js/jquery.fancybox.min.js></script>
<script src=/js/jquery.min.js></script>
<link rel=stylesheet href=/css/jquery.fancybox.min.css><div class=polaris-footer><span>@ 2022 The PolarisMesh Authors</span>
<span class=high-resolution>|</span>
<span>A Tencent Microservice Project</span>
<a href=https://beian.miit.gov.cn/#/Integrated/index>粤B2-20090059</a><div class=polaris-footer-background></div></div></div><script src=/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>