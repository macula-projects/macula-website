<!doctype html><html lang=zh-cn class=no-js><script>var throttle=function(e,t){var n=Date.now();return function(){var s=this,o=arguments,i=Date.now();i-n>=t&&(e.apply(s,o),n=Date.now())}};window.addEventListener("load",function(){document.getElementById("doc-outer").onscroll=throttle(function(){const o=document.querySelectorAll(".td-content h1,.td-content h2,.td-content h3,.td-content h4,.td-content h5,.td-content h6"),i=document.documentElement.scrollTop;let e=[];for(let t=0;t<o.length;t++){const n=o[t];n&&e.push({id:n.id,top:n.getBoundingClientRect().top})}e=e.filter(e=>e.top>0).sort((e,t)=>e.top-t.top);let n=e[0];if(!document.getElementById("TableOfContents"))return;const t=Array.from(document.getElementById("TableOfContents").getElementsByTagName("a"));t.forEach(e=>e.classList.remove("active")),n||(n={id:t[0].id});let s=t.find(e=>{const t=window.decodeURIComponent(e.href).split("#")[1];return!!t&&t===n.id});s||(s=t[0]),s.classList.add("active")},50)})</script><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><meta name=robots content="index, follow"><link rel=icon href=/favicons/favicon.ico><title>展示层 | Macula</title><meta name=description content="本文介绍展示层的开发过程"><meta property="og:title" content="展示层"><meta property="og:description" content="本文介绍展示层的开发过程"><meta property="og:type" content="article"><meta property="og:url" content="/docs/v3.1/chapter2/05_controller/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-05-10T20:15:09+08:00"><meta property="og:site_name" content="Macula"><meta itemprop=name content="展示层"><meta itemprop=description content="本文介绍展示层的开发过程"><meta itemprop=dateModified content="2023-05-10T20:15:09+08:00"><meta itemprop=wordCount content="1626"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="展示层"><meta name=twitter:description content="本文介绍展示层的开发过程"><link rel=preload href=/scss/main.min.56f91794193debaacc9fed9f3ea1305973c18c460520344068f08ae5f95e5027.css as=style><link href=/scss/main.min.56f91794193debaacc9fed9f3ea1305973c18c460520344068f08ae5f95e5027.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/><span>首页</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/project><span>项目</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs><span>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=http://14.22.2.220:80/#/login target=_blank><span>体验版</span></a></li></ul></div></nav></header><div class="container-fluid td-outer" id=doc-outer><div class=td-main><div class="row flex-xl-nowrap" style=height:100%><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=搜索 aria-label=搜索 autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><ul class=ul-1><li class="td-sidebar-nav__section-headtitle td-sidebar-nav__section with-child active-path" id=m-docsv31-li><a href=/docs/v3.1/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31><span>Macula 3.1</span></a><ul class=ul-2><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsv31chapter1-li><a href=/docs/v3.1/chapter1/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter1><span>第一章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter101_introduction-li><a href=/docs/v3.1/chapter1/01_introduction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter101_introduction><span>概述</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter102_quick_start-li><a href=/docs/v3.1/chapter1/02_quick_start/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter102_quick_start><span>快速开始</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter103_project_building-li><a href=/docs/v3.1/chapter1/03_project_building/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter103_project_building><span>项目构建</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter104_release_nodes-li><a href=/docs/v3.1/chapter1/04_release_nodes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter104_release_nodes><span>版本发布</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsv31chapter2-li><a href=/docs/v3.1/chapter2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter2><span>第二章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter201_configuration-li><a href=/docs/v3.1/chapter2/01_configuration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter201_configuration><span>配置文件</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter201_dynaconfig-li><a href=/docs/v3.1/chapter2/01_dynaconfig/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter201_dynaconfig><span>统一动态属性配置</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter202_domain-li><a href=/docs/v3.1/chapter2/02_domain/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter202_domain><span>领域模型层</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter202_project_start-li><a href=/docs/v3.1/chapter2/02_project_start/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter202_project_start><span>项目集成</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter203_repository-li><a href=/docs/v3.1/chapter2/03_repository/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter203_repository><span>数据存取层</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter204_service-li><a href=/docs/v3.1/chapter2/04_service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter204_service><span>业务服务层</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter205_controller-li><a href=/docs/v3.1/chapter2/05_controller/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter205_controller><span class=td-sidebar-nav-active-item>展示层</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter206_timezone-li><a href=/docs/v3.1/chapter2/06_timezone/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter206_timezone><span>时间设置</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter207_exception-li><a href=/docs/v3.1/chapter2/07_exception/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter207_exception><span>异常处理</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter208_cache-li><a href=/docs/v3.1/chapter2/08_cache/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter208_cache><span>缓存服务</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter209_junit-li><a href=/docs/v3.1/chapter2/09_junit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter209_junit><span>单元测试</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsv31chapter210_event-li><a href=/docs/v3.1/chapter2/10_event/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter210_event><span>事件机制</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsv31chapter3-li><a href=/docs/v3.1/chapter3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter3><span>第三章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter301_plugins_app-li><a href=/docs/v3.1/chapter3/01_plugins_app/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter301_plugins_app><span>应用相关</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter302_plugins_dataset-li><a href=/docs/v3.1/chapter3/02_plugins_dataset/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter302_plugins_dataset><span>数据相关</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter304_plugins-user-li><a href=/docs/v3.1/chapter3/04_plugins-user/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter304_plugins-user><span>用户相关</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter305_plugins_authentication-li><a href=/docs/v3.1/chapter3/05_plugins_authentication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter305_plugins_authentication><span>用户认证</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter305_plugins_security-li><a href=/docs/v3.1/chapter3/05_plugins_security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter305_plugins_security><span>安全相关</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter306_plugins_authority-li><a href=/docs/v3.1/chapter3/06_plugins_authority/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter306_plugins_authority><span>权限管理</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter308_plugins_expr-li><a href=/docs/v3.1/chapter3/08_plugins_expr/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter308_plugins_expr><span>表达式解析</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter307_plugins_policy-li><a href=/docs/v3.1/chapter3/07_plugins_policy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter307_plugins_policy><span>业务策略</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter310_openapi-li><a href=/docs/v3.1/chapter3/10_openapi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter310_openapi><span>OpenAPI</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsv31chapter4-li><a href=/docs/v3.1/chapter4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter4><span>第四章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter401_webapp-li><a href=/docs/v3.1/chapter4/01_webapp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter401_webapp><span>WEB应用基础</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter402_admin-li><a href=/docs/v3.1/chapter4/02_admin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter402_admin><span>后台管理</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter403_mda-li><a href=/docs/v3.1/chapter4/03_mda/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter403_mda><span>表单与查询</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter404_rule-li><a href=/docs/v3.1/chapter4/04_rule/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter404_rule><span>规则引擎</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter405_workflow-li><a href=/docs/v3.1/chapter4/05_workflow/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter405_workflow><span>工作流</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter406_dubbo-li><a href=/docs/v3.1/chapter4/06_dubbo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter406_dubbo><span>Dubbo</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter407_esb-li><a href=/docs/v3.1/chapter4/07_esb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter407_esb><span>ESB</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter408_mq-li><a href=/docs/v3.1/chapter4/08_mq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter408_mq><span>阿里MQ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter409_monitor-li><a href=/docs/v3.1/chapter4/09_monitor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter409_monitor><span>系统监控</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsv31chapter5-li><a href=/docs/v3.1/chapter5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter5><span>第五章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter501_standard_code-li><a href=/docs/v3.1/chapter5/01_standard_code/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter501_standard_code><span>Java代码规范</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter502_standard_check-li><a href=/docs/v3.1/chapter5/02_standard_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter502_standard_check><span>代码审计规范</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter503_standard_junit-li><a href=/docs/v3.1/chapter5/03_standard_junit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter503_standard_junit><span>单元测试标准</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter504_standard_library-li><a href=/docs/v3.1/chapter5/04_standard_library/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter504_standard_library><span>第三方包使用标准</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter505_standard_import-li><a href=/docs/v3.1/chapter5/05_standard_import/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter505_standard_import><span>新技术引入标准</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsv31chapter6-li><a href=/docs/v3.1/chapter6/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv31chapter6><span>第六章</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv31chapter601_tables-li><a href=/docs/v3.1/chapter6/01_tables/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv31chapter601_tables><span>表结构</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-headtitle td-sidebar-nav__section with-child" id=m-docsv40-li><a href=/docs/v4.0/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40><span>Macula 4.0</span></a><ul class=ul-2><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40preface-li><a href=/docs/v4.0/preface/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40preface><span>序言</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsv40quickstart-li><a href=/docs/v4.0/quickstart/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40quickstart><span>快速开始</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40quickstart01_environment-li><a href=/docs/v4.0/quickstart/01_environment/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40quickstart01_environment><span>环境准备</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40quickstart02_projects-li><a href=/docs/v4.0/quickstart/02_projects/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40quickstart02_projects><span>项目搭建</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40quickstart03_run-li><a href=/docs/v4.0/quickstart/03_run/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40quickstart03_run><span>项目运行</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsv40feature-li><a href=/docs/v4.0/feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40feature><span>基本特性</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature06_templatequery-li><a href=/docs/v4.0/feature/06_templatequery/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature06_templatequery><span>TemplateQuery</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature12_web-li><a href=/docs/v4.0/feature/12_web/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature12_web><span>WEB</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature11_e5ae89e585a8e79bb8e585b3-li><a href=/docs/v4.0/feature/11_%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature11_e5ae89e585a8e79bb8e585b3><span>安全相关</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature05_e5a49ae7bc93e5ad98e9858de7bdae-li><a href=/docs/v4.0/feature/05_%E5%A4%9A%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature05_e5a49ae7bc93e5ad98e9858de7bdae><span>多缓存配置</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature04_e5a49ae695b0e68daee6ba90e9858de7bdae-li><a href=/docs/v4.0/feature/04_%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature04_e5a49ae695b0e68daee6ba90e9858de7bdae><span>多数据源配置</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature09_e58886e5b883id-li><a href=/docs/v4.0/feature/09_%E5%88%86%E5%B8%83id/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature09_e58886e5b883id><span>分布式ID</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature08_e58886e5b883e5bc8fe99481-li><a href=/docs/v4.0/feature/08_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature08_e58886e5b883e5bc8fe99481><span>分布式锁</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature03_e59bbde99985e58c96-li><a href=/docs/v4.0/feature/03_%E5%9B%BD%E9%99%85%E5%8C%96/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature03_e59bbde99985e58c96><span>国际化</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature01_e59fbae69cace9858de7bdae-li><a href=/docs/v4.0/feature/01_%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature01_e59fbae69cace9858de7bdae><span>基本配置</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature07_e6a8a1e59e8be8bdace68da2-li><a href=/docs/v4.0/feature/07_%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature07_e6a8a1e59e8be8bdace68da2><span>模型转换</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature10_e8aea4e8af81e58f8ae69d83e99990-li><a href=/docs/v4.0/feature/10_%E8%AE%A4%E8%AF%81%E5%8F%8A%E6%9D%83%E9%99%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature10_e8aea4e8af81e58f8ae69d83e99990><span>认证及权限</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40feature02_e7bb9fe4b880e5bc82e5b8b8e5a484e79086-li><a href=/docs/v4.0/feature/02_%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40feature02_e7bb9fe4b880e5bc82e5b8b8e5a484e79086><span>统一异常处理</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-docsv40advance-li><a href=/docs/v4.0/advance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40advance><span>高级实战</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance01_dubbo-li><a href=/docs/v4.0/advance/01_dubbo/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance01_dubbo><span>Dubbo：高性能 RPC 分布式服务框架</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance07_gateway-li><a href=/docs/v4.0/advance/07_gateway/ title="Gateway .. " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance07_gateway><span>Gateway ..</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance02_nacos-li><a href=/docs/v4.0/advance/02_nacos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance02_nacos><span>Nacos : 动态服务发现、配置管理平台</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance08_oauth2-li><a href=/docs/v4.0/advance/08_oauth2/ title="Oauth2 .. " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance08_oauth2><span>Oauth2 ..</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance03_powerjob-li><a href=/docs/v4.0/advance/03_powerjob/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance03_powerjob><span>Power Job: 统一调度平台</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance05_rocketmq-li><a href=/docs/v4.0/advance/05_rocketmq/ title="RocketMQ .. " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance05_rocketmq><span>RocketMQ ..</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance06_seata-li><a href=/docs/v4.0/advance/06_seata/ title="Seata .. " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance06_seata><span>Seata ..</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40advance04_sentinel-li><a href=/docs/v4.0/advance/04_sentinel/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsv40advance04_sentinel><span>Sentinel ：分布式系统的流量防卫兵</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40production-li><a href=/docs/v4.0/production/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40production><span>生产部署</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsv40upgrade-li><a href=/docs/v4.0/upgrade/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsv40upgrade><span>版本升级</span></a></li></ul></li><li class="td-sidebar-nav__section-headtitle td-sidebar-nav__section with-child" id=m-docsnotices-li><a href=/docs/notices/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsnotices><span>公告栏</span></a><ul class=ul-2><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsnoticessecurity-li><a href=/docs/notices/security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsnoticessecurity><span>安全漏洞</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-3 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/google/docsy-example/edit/master/content/zh-cn/docs/v3.1/chapter2/05_Controller.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/google/docsy-example/issues/new?title=%e5%b1%95%e7%a4%ba%e5%b1%82" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#controller编写>Controller编写</a><ul><li><a href=#使用基类controller>使用基类Controller</a></li><li><a href=#表单校验valid>表单校验@Valid</a></li><li><a href=#表单绑定formbean>表单绑定@FormBean</a></li><li><a href=#html表单input-name与后端参数转换规则>HTML表单input name与后端参数转换规则</a></li><li><a href=#pageable参数绑定>Pageable参数绑定</a></li><li><a href=#id到domain类型转换>ID到Domain类型转换</a></li><li><a href=#excelview>ExcelView</a></li></ul></li><li><a href=#freemarker模板编写>Freemarker模板编写</a><ul><li><a href=#页面布局>页面布局</a></li><li><a href=#页面布局宏的定义>页面布局宏的定义</a></li><li><a href=#后端页面布局定制>后端页面布局定制</a></li><li><a href=#前端页面布局定制>前端页面布局定制</a></li><li><a href=#ui宏>UI宏</a></li></ul></li><li><a href=#前端开发框架>前端开发框架</a></li><li><a href=#macula宏>Macula宏</a><ul><li><a href=#权限判断>权限判断</a></li><li><a href=#下拉框>下拉框</a></li><li><a href=#避免重复提交的token>避免重复提交的Token</a></li></ul></li><li><a href=#freemarker内置变量>FreeMarker内置变量</a><ul><li><a href=#登录用户信息>登录用户信息</a></li><li><a href=#菜单变量>菜单变量</a></li><li><a href=#freemarker内置方法>Freemarker内置方法</a></li></ul></li><li><a href=#国际化>国际化</a></li><li><a href=#地址规划>地址规划</a></li><li><a href=#请求方式规划>请求方式规划</a></li><li><a href=#restful-api>RESTful API</a><ul><li><a href=#rest数据返回格式>REST数据返回格式</a></li></ul></li><li><a href=#heading></a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 doc-main pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>文档</a></li><li class=breadcrumb-item><a href=/docs/v3.1/>Macula 3.1</a></li><li class=breadcrumb-item><a href=/docs/v3.1/chapter2/>第二章</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/v3.1/chapter2/05_controller/ aria-disabled=true class="btn-link disabled">展示层</a></li></ol></nav><div class=td-content><h1>展示层</h1><div class=lead>本文介绍展示层的开发过程</div><header class=article-meta></header><p>在Macula开发平台下，建议使用Spring MVC + Freemarker的方式来实现展现层。</p><p>同时对于Ajax部分，在javascript框架中建议使用jquery框架。</p><h2 id=controller编写>Controller编写</h2><h3 id=使用基类controller>使用基类Controller</h3><p>在展示层编写的Controller实现，需要直接或间接扩展至BaseController</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;admin/macula-base&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AdminMaculaBaseController</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>BaseController</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>//something
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>在BaseController中处理了大量的异常处理方式以及数据返回要求的设定。</p><h3 id=表单校验valid>表单校验@Valid</h3><p>在Controller中的参数中，使用@FormBean注解来绑定页面数据到Bean，如果转换失败，则失败结果会出现在BindingResult中</p><p>在Controller中的参数中，使用@Valid注解来检查页面数据到Domain数据是否符合校验规则，校验规则的定义是在Bean中完成的，采用JSR-303的Bean Validator标准定义。校验失败的结果同样保存在BindingResult中</p><p>失败结果可以通过BaseController中的getMergedBindingResults方法得到，具体使用请参考BaseController类的使用说明。</p><h3 id=表单绑定formbean>表单绑定@FormBean</h3><p>在Spring MVC默认的基础上，Macula开发平台在参数绑定上做了适当扩展，以适应与Struts（Webwork）等相同的对参数处理的一致性，具体来说，有如下的变化：</p><ol><li><p>Bean参数绑定</p><p>默认情况下，String MVC对参数的绑定方式，采用直接属性名与给定POJO属性名相同的方式实现绑定，为了更好的区分具体的参数信息，Macula平台扩展了这类绑定，允许</p><pre tabindex=0><code>pojo名+ . + 属性名
</code></pre><p>的方式绑定。</p><p><strong>例 1. 两种绑定的区别</strong></p><p>比如在Controller中，会传入用户信息保存，其Controller原型为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// something
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>此时客户端提交的参数信息为：</p><pre tabindex=0><code>?userName=Wilson&amp;password=123456
</code></pre><p>此时Spring自动将userName和password绑定生成User对象。但这种方式在返回多个对象时不太适用，所以Macula平台通过扩展，可通过修改Controller中的原型为：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@Valid</span> <span style=color:#5c35cc;font-weight:700>@FormBean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;user&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>hasErrors</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getMergedBindingResults</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// something
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>通过Macula平台扩展后的提交的数据格式，将可以通过下面提交方式绑定：</p><pre tabindex=0><code>?user.userName=Wilson&amp;user.password=123456
</code></pre><p>为实现这个扩展，主要在于applicationContext-mvc.xml文件中的BeanArgumentResolver定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customArgumentResolvers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>           <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.FormBeanArgumentResolver&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>               <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>           <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>通过对自定义参数的解析，可以实现上述的变化。</p><p><em><strong>重要</strong></em></p><p><em>需要注意的是，使用Macula平台的绑定方式的前提是：必须使用@FormBean前缀，并且不能使用诸如@ModelAttribute、@RequestBody等Spring的绑定注解。</em></p></li><li><p>FormBean的表单防重复提交</p><p>在Form提交时，为了防止用户对表单的重复提交，除了使用客户端脚本控制按钮的状态外，平台提供了防重复提交的解决方案。</p><p>一般情况下，防重复提交有2个应用场景：<strong>1)防止用户无意识的重复提交；2)防止用户恶意的重复提交。</strong></p><p>对于无意识的提交，只需要在页面隐藏一个唯一性的Token，在表单提交时返回，在服务端校验并销毁即可完成对Token的验证而阻止该提交。</p><p>对于用户可能存在的恶意提交，可通过在表单提交时，插入验证码的方式来进行，用户必须正确输入了验证码，并在服务端校验成功后，才能进行业务逻辑的处理。</p><p>在平台实现的方式上，采用在FormBean注解中加入属性：</p><p>valid：(boolean)是否需要检测重复提交；</p><p>token：(String)在表单页面中提交的参数名称，默认值为ftoken，除非与业务中的字段冲突，否则不需要设置为其他值；</p><p>captcha：(boolean)是否检测验证码，来防止恶意提交</p><p>整个校验过程由FormBeanArgumentResolver完成。</p><p>相应的，在界面层面，需要配合在表单中加入防重复提交信息，在macula.ftl中提供了freemarker宏的默认实现。在该默认实现情况下，可通过在表单位置加入&lt;@macula.formToken />即可，对于需要加入校验码的情况下，使用&lt;@macula.formToken captcha=true /></p><p>具体的实现可参考macula.ftl文件。</p><p><em><strong>重要</strong></em></p><p><em>主要注意在同一个RequestMapping的方法中，如果有多个通过@FormBean注释的参数，在第一个使用FormBean注释的参数中加入该特性即可，其他不要加。<br>特别地，加入了自动控制防重复提交后，生成的客户端token只能进行一次校验即失效，所以在提交后，如果表单需要再次提交，需要更新隐藏的token的值。在默认情况下，调用$(form).trigger(&lsquo;changeCaptcha&rsquo;)即可更新，如果需要定制，可参考macula.ftl中的实现，做自定义的宏来处理。</em></p></li></ol><h3 id=html表单input-name与后端参数转换规则>HTML表单input name与后端参数转换规则</h3><p>本节继续上级讲解复杂的@FormBean对象是如何与HTML表单数据绑定的，假如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@OpenApi</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(...)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>saveUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@FormBean</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>User类如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>password</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Org</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Org</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>orgs</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Org</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>girls</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>date</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Org</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>code</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>那么HTML表单中input框的name应该如下命名：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.userName&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.password&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.org.code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.orgs[0].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.orgs[1].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.params[&#39;key1&#39;]&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.params[&#39;key2&#39;]&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.girls[&#39;key1&#39;].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.girls[&#39;key2&#39;].code&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>input</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;user.date&#34;</span> <span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span></code></pre></div><ul><li><p>原子类型：例如long,int,String等，需要形成“参数名=值”的键值对传递；</p></li><li><p>POJO对象：如User，需要形成“参数名.属性名=值”的键值对传递；</p></li><li><p>原子类型数组：如String[]、List，需要形成“参数名=值0”、“参数名=值1”等的键值对传递；</p></li><li><p>POJO对象数组：如User[]、List，需要形成“参数名[index].属性名=值”等的键值对，index为数组下标；</p></li><li><p>Map：需要形成“参数名[key]=值”的键值对传递；</p></li><li><p>Map：需要形成“参数名[key].属性名=值”的键值对传递；</p></li><li><p>对于POJO对象中如果含有POJO数组、Map、POJO则规则同上，而原子类型数组需要写成“属性名[index]=值”。</p></li></ul><h3 id=pageable参数绑定>Pageable参数绑定</h3><p>在使用了Spring-Data框架够，对于多数分页式查询，可通过直接传入Pageable参数和额外的参数条件，即可返回包括总记录数、当前页面记录等信息的Page对象返回，对于Controller层，方便的获得页面传递的Pageable参数并构造成相应的对象值，也是一种代码简洁和易用性上的提升。</p><p>对于Pageable参数的绑定，比如Controller中编写：</p><ol><li><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/test/user/list&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GET</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Pageable</span> <span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>userRespository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// other coding...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>为了实现这个扩展，主要在applicationContext-mvc.xml文件中的PageableArgumentResolver定义：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;webBindingInitializer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customArgumentResolvers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.PageableArgumentResolver&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>           
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>Pageable参数绑定时，将直接从Request参数中获取，如果在一个方法中，需要构建多个Pageable对象，可通过@Qualifier来指定别名，这样在Request中获取属性 别名+ &ldquo;_&rdquo; + 属性名，来构建Pageable对象。</p><p>request参数包括：page(页码)、rows(每页行数)、sort(按什么排序,格式是field1,field2&mldr;,asc或者desc，可以多个sort参数，最后一个表示排序类型)</p><p><em><strong>重要</strong></em></p><p><em>这里Pageable与Bean构建的区别在于，默认情况下Pageable直接从Request中获取数据，而在通过@Qualifier指定别名时，Bean的属性获取规则是 别名+ &ldquo;.&rdquo; + 属性名，而Pageable的规则是 别名+ &ldquo;_</em>&rdquo; +属性名。</p></li></ol><h3 id=id到domain类型转换>ID到Domain类型转换</h3><p>很多情况下，在编辑时或者在查看详细信息时，总是通过传入一个主键值（通常是Long型），来获取具体的记录信息，在Macula平台中，为了简化这种操作，对于已定义的Domain类，可以通过已定义的ConversionService直接转换。</p><p>对应的applicationContext-mvc.xml中配置如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;conversionService&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.format.support.FormattingConversionServiceFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;converters&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.RepositoryConverter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>配置该转化后，需要转化的类型必须实现Persistable接口，并且定义了相对应的JpaRepository，否则也不能正常转换。</p><p><em><strong>重要</strong></em></p><p><em>除了加入该ConversionService外，还需要注意：</em></p><ul><li><p><em>普通的VO对象不要实现Persistable接口，即不能使用该转换</em></p></li><li><p><em>待转化类必须实现Persistable接口</em></p></li><li><p><em>该转换Domain对象，在Spring上下文中，已经定义了相应的JpaRepository Bean，用来通过主键载入该对象值</em></p><p><em><strong>例 2. 通过传入主键，直接转化为相应的对象</strong></em></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/test/user/{userId}/edit&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GET</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>edit</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@PathVariable</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userId&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>如上面的Controller中的定义可见，传入的userId是一个字符串（或者可以认为是Long型），但在edit方法中，可直接定义为User user，即由macula平台实现了对主键到相应Domain实例的转换。</p><p>当然，这里的User对象实现了Persistable接口，并已有相应的UserRepository extends <code>JpaRepository&lt;User>的实现。</code></p></li></ul><h3 id=excelview>ExcelView</h3><p>为了更好的支持Excel的导出功能，系统提供了ExcelView类结合ExcelUtils的Excel模板方式导出Excel。只要按照ExcelUtils的语法制作Excel模板，然后放在FreeMarker模板文件放置的目录中，在Controller中如下使用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ModelAndView</span> <span style=color:#000>excel2</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>model</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>model</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;变量&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ModelAndView</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExcelView</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getRelativePath</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;/so_master/excel&#34;</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#000>model</span><span style=color:#ce5c00;font-weight:700>);</span>                   
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>上述代码将会去views/admin[front]/xxxx/so_master/目录下寻找excel.xls的Excel模板文件，然后通过ExcelUtils解析该模板文件生成需要的Excel文件。</p><h2 id=freemarker模板编写>Freemarker模板编写</h2><h3 id=页面布局>页面布局</h3><p>Macula 使用 FreeMarker 宏来规范ftl页面模板的开发：</p><ul><li><strong>后端默认布局界面编写</strong></li></ul><pre tabindex=0><code>&lt;@layout.mower_admin title=&#34;Dashboard&#34;&gt;
    具体业务内容
&lt;/@layout.mower_admin&gt;
</code></pre><ul><li><strong>前端默认界面布局编写：</strong></li></ul><pre tabindex=0><code>&lt;@layout.mower_front title=&#34;Dashboard&#34;&gt;
    &lt;@ui.main_breadcrumb rootType=&#39;front&#39; menuCode=&#34;FRONT_TEST_MENU1&#34; /&gt;
    &lt;@ui.main_wrapper&gt;
        &lt;@ui.main_content&gt;
            Dashborad
        &lt;/@ui.main_content&gt;
    &lt;/@ui.main_wrapper&gt;
&lt;/@layout.mower_front&gt;
</code></pre><p><em><strong>重要</strong></em></p><p>布局可以根据是否AJAX请求自动判断是否输出javascript和css的脚本</p><h3 id=页面布局宏的定义>页面布局宏的定义</h3><p>我们先看看freemarker整个宏文件的定义逻辑：</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/layout_mower.png><img src=/docs/imgs/v3.1/chapter2/layout_mower.png alt></a></p><p>在views根目录下，有个layout.ftl是整个布局宏的入口：</p><pre tabindex=0><code>&lt;#macro includeScripts scripts&gt;
    &lt;#if scripts?exists &amp;&amp; scripts != &#39;&#39;&gt;
        &lt;#list scripts?split(&#34;,&#34;) as jsItem&gt;
            &lt;script id=&#34;${jsItem?trim?replace(&#39;.&#39;, &#39;_&#39;)?replace(&#39;/&#39;, &#39;_&#39;)}&#34; type=&#34;text/javascript&#34;&gt;
                &lt;#include &#34;/${jsItem?trim?replace(&#39;.js&#39;, minVersion+&#39;.js&#39;)}&#34; parse=false /&gt;
            &lt;/script&gt;
        &lt;/#list&gt;
    &lt;/#if&gt;
&lt;/#macro&gt;

&lt;#include &#34;/admin/layout.ftl&#34; /&gt;
&lt;#include &#34;/admin/layout_mower.ftl&#34; /&gt;
&lt;#include &#34;/front/layout_mower.ftl&#34; /&gt;
&lt;#include &#34;/mobile/layout_mower.ftl&#34; /&gt;
</code></pre><p>admin目录下，layout.ftl是macula2.0版本的界面布局，layout_mower.ftl是macula 3.0的布局宏定义，下面讲讲这个文件：</p><pre tabindex=0><code>&lt;#global resources_admin=&#34;${resourceHost!&#39;&#39;}/resources/mower/${appVersion!&#39;&#39;}/admin&#34; /&gt;
&lt;#global views_admin=&#34;${resourceHost!&#39;&#39;}/views/mower/${appVersion!&#39;&#39;}/admin&#34; /&gt;

&lt;#macro mower_admin_head title = &#39;&#39; require = &#39;&#39;&gt;
    meta、css等脚本定义        
&lt;/#macro&gt;

&lt;#macro mower_admin_header_logo&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_header_menu&gt;
    ...  
&lt;/#macro&gt;

&lt;#macro mower_admin_header_login&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_footer&gt;
    ...
&lt;/#macro&gt;

&lt;#macro mower_admin_scripts require = &#39;&#39;&gt;
    js引入定义
&lt;/#macro&gt;

&lt;!--给用户自定义宏的机会 --&gt;
&lt;#include &#34;/admin/app/layout_mower.ftl&#34; /&gt;

&lt;#macro mower_admin title scripts = &#39;&#39; version = &#39;&#39; require = &#39;&#39;&gt;
&lt;#global ui_name = &#39;mower&#39; /&gt;
&lt;#global ui_path = &#39;admin&#39; /&gt;
&lt;#if Request[&#39;isAjaxRequest&#39;]?exists &amp;&amp; Request[&#39;isAjaxRequest&#39;] == true&gt;
    &lt;#if title?exists&gt;&lt;title&gt;${title?if_exists}&lt;/title&gt;&lt;/#if&gt;
    &lt;#if version?exists&gt;&lt;meta content=&#34;${(version?replace(&#34;(\\$)|(\\s\\$)|(Revision:\\s)&#34;, &#34;&#34;, &#34;r&#34;))?if_exists}-${appVersion!&#34;&#34;}&#34;&gt;&lt;/#if&gt;
    &lt;#nested /&gt;
    &lt;@includeScripts scripts /&gt;
&lt;#else&gt;
    &lt;!DOCTYPE html&gt;
    &lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;
    &lt;head&gt;
        &lt;@mower_admin_head title=&#34;${title?if_exists}&#34; require = &#34;${require!&#39;&#39;}&#34; /&gt;
        &lt;script type=&#34;text/javascript&#34;&gt;
            ...         
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body data-base=&#34;${base}&#34;&gt;

    &lt;noscript&gt;
        &lt;div class=&#34;noscript error&#34;&gt;
            您好，要正常运行应用程序，浏览器必须支持Javascript！
        &lt;/div&gt;
    &lt;/noscript&gt;

    &lt;!-- Loading Container --&gt;
    &lt;div class=&#34;loading-container&#34;&gt;
       &lt;div class=&#34;loader&#34;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--  /Loading Container --&gt;    

    &lt;!-- BEGIN HEADER --&gt;
    &lt;div id=&#34;header&#34; class=&#34;mu-header-container&#34;&gt;
        &lt;!-- BEGIN MAIN MENU --&gt;
        &lt;div class=&#34;navbar&#34; role=&#34;navigation&#34;&gt;
            &lt;div class=&#34;navbar-inner&#34;&gt;
                &lt;div class=&#34;navbar-container&#34;&gt;
                    &lt;@mower_admin_header_logo /&gt;
                    &lt;!-- Sidebar Collapse --&gt;
                    &lt;div class=&#34;sidebar-collapse&#34; id=&#34;sidebar-collapse&#34;&gt;
                        &lt;i class=&#34;collapse-icon fa fa-bars&#34;&gt;&lt;/i&gt;
                    &lt;/div&gt;
                    &lt;!-- /Sidebar Collapse --&gt;
                    &lt;@mower_admin_header_menu /&gt;
                    &lt;@mower_admin_header_login /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- END HEADER --&gt;

    &lt;!-- BEGIN MAIN --&gt;
    &lt;div class=&#34;mu-main-container container-fluid&#34;&gt;
        &lt;!-- BEGIN SIDEBAR --&gt;
        &lt;div class=&#34;mu-sidebar-wrapper&#34;&gt;
            &lt;div class=&#34;mu-sidebar&#34; id=&#34;sidebar&#34;&gt;
                &lt;!-- Page Sidebar Header--&gt;
                &lt;div class=&#34;sidebar-header-wrapper&#34;&gt;
                    &lt;input type=&#34;text&#34; class=&#34;searchinput&#34;&gt;
                    &lt;i class=&#34;searchicon fa fa-search&#34;&gt;&lt;/i&gt;
                    &lt;div class=&#34;searchhelper&#34;&gt;搜索菜单&lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- /Page Sidebar Header --&gt;
                &lt;!-- Sidebar Menu --&gt;
                &lt;ul class=&#34;nav sidebar-menu&#34; style=&#34;&#34;&gt;
                &lt;/ul&gt;
                &lt;!-- /Sidebar Menu --&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;!-- END SIDEBAR --&gt;    

        &lt;!-- BEGIN CONTENT --&gt;
        &lt;div class=&#34;mu-content-wrapper&#34;&gt;
            &lt;div class=&#34;mu-content&#34;&gt;
                &lt;!-- BEGIN BREADCRUMB --&gt;
                &lt;div class=&#34;mu-content-header&#34;&gt;
                    &lt;div class=&#34;mu-breadcrumb-wrapper&#34;&gt;
                        &lt;ul class=&#34;breadcrumb&#34; data-target=&#34;#mainContent&#34;&gt;
                            &lt;li data-target=&#34;breadcrumb0&#34; class=&#34;active&#34;&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                    &lt;div class=&#34;header-buttons&#34;&gt;
                        &lt;a class=&#34;sidebar-toggler&#34; href=&#34;#&#34;&gt;
                            &lt;i class=&#34;fa fa-arrows-h&#34;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                        &lt;a class=&#34;refresh&#34; id=&#34;refresh-toggler&#34; href=&#34;&#34;&gt;
                            &lt;i class=&#34;glyphicon glyphicon-refresh&#34;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                        &lt;a class=&#34;favorite&#34; id=&#34;favorite-toggler&#34; href=&#34;#&#34;&gt;
                            &lt;i class=&#34;fa fa-star fa-lg&#34;&gt;&lt;/i&gt;
                        &lt;/a&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;!-- END BREADCRUMB--&gt;
                &lt;div class=&#34;mu-content-body&#34;&gt;
                    &lt;div class=&#34;row&#34;&gt;
                        &lt;div class=&#34;col-md-12&#34;&gt;
                            &lt;div id=&#34;mainContent&#34;&gt;
                                &lt;div data-panel=&#34;breadcrumb0&#34;&gt;
                                    &lt;#nested /&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;        
    &lt;/div&gt;
    &lt;!-- END MAIN --&gt;

    &lt;!-- BEGIN FOOTER --&gt;
    &lt;div id=&#34;footer&#34; class=&#34;mu-footer&#34;&gt;
        &lt;@mower_admin_footer /&gt;
    &lt;/div&gt;
    &lt;!-- END FOOTER --&gt;

    &lt;@mower_admin_scripts require = &#34;${require!&#39;&#39;}&#34; /&gt;

    &lt;!-- BEGIN PAGE LEVEL SCRIPTS --&gt;
    &lt;script type=&#34;text/javascript&#34; src=&#34;${resources_admin}/app/js/config${minVersion!&#34;&#34;}.js&#34;&gt;&lt;/script&gt;
    &lt;script type=&#34;text/javascript&#34; src=&#34;${resources_admin}/app/js/app${minVersion!&#34;&#34;}.js&#34;&gt;&lt;/script&gt;

    &lt;@includeScripts scripts=&#34;admin/app/layout_mower.js&#34; /&gt;
    &lt;@includeScripts scripts=&#34;ui/app/ui.js&#34; /&gt;
    &lt;@includeScripts scripts /&gt;
    &lt;!-- END PAGE LEVEL SCRIPTS --&gt;
    &lt;/body&gt;
    &lt;/html&gt;
&lt;/#if&gt;
&lt;/#macro&gt;
</code></pre><p><em><strong>提示</strong></em><br>&lt;@layout.mower_admin title scripts = &lsquo;页面脚本&rsquo; version = &rsquo;&rsquo; require = &lsquo;angularjs/knockoutjs/vue&rsquo;></p><p>&lt;/@layout.mower_admin></p><ul><li><p>scripts是您的页面对应的脚本，路径以views下面的目录为准</p></li><li><p>title 页面标题</p></li><li><p>version 页面版本</p></li><li><p>require 要引入的MVC JS文件，支持angularjs、knockoutjs、vue</p></li></ul><p>这个宏是业务页面的主要的宏，一般情况下，不要脱离这个宏做页面，这样未来修改时可以整体替换。</p><h3 id=后端页面布局定制>后端页面布局定制</h3><p>下面我们以后台管理页面为例进行讲解。后台管理页面布局如下图所示：</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/macula-layout.png><img src=/docs/imgs/v3.1/chapter2/macula-layout.png alt=macula-layout></a></p><p>由上图可见，Macula 页面由 header，main container 和 footer 三部分组成。其中，header 由 logo，menu 和 login 组成；main container 主要包括 sidebar 和 content 两大部分；footer 构成比较简单。</p><p>为了方便大家理解，我们以一个实际的页面为例子说明各个部分。</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/macula-layout-demo.png><img src=/docs/imgs/v3.1/chapter2/macula-layout-demo.png alt=macula-layout-demo></a></p><p>开发者可以通过修改自己项目中的如下这个文件来自定义自己的 header logo，header menu，header login 和 footer。</p><p>app目录中的layout_mower.ftl文件可以覆盖，同时会重新定义admin/layout_mower.ftl中的相关宏。</p><p>我们来看一下admin/app目录下的这个文件里面的内容：</p><pre tabindex=0><code>&lt;#--
使用者可以通过覆盖这个文件实现对一些宏的重新定义包括：
-- html head中的内容，包括meta css等
&lt;#macro mower_admin_head title = &#39;&#39;&gt;
-- LOGO
&lt;#macro mower_admin_header_logo&gt;
-- 菜单栏
&lt;#macro mower_admin_header_menu&gt;
-- 登录后提示信息
&lt;#macro mower_admin_header_login&gt;
-- 页脚
&lt;#macro mower_admin_footer&gt;
包含的Javascript(angularjs,knockoutjs,datagrid)
&lt;#macro mower_admin_scripts require = &#39;&#39;&gt;
--&gt;

&lt;#--
局部替换：如果以下变量定义在具体业务模板中，则会覆盖你的layout模板中的定义

&lt;#global mower_admin_scripts_addition&gt;
    加入你自己的javascript库文件
&lt;/#global&gt;

&lt;#global mower_admin_head_addition&gt;
    加入你自己的css文件
&lt;/#global&gt;
--&gt;
</code></pre><p>由上面的代码可见，我们可以通过修改宏 mower_admin_header_logo 来自定义自己的 header logo；同样道理我们可以通过修改宏 mower_admin_header_menu，mower_admin_header_login，以及 mower_admin_footer 来分别定义自己的 header menu，header login 和 footer。</p><h3 id=前端页面布局定制>前端页面布局定制</h3><p>与后端定制类似，front/app/layout_mower.ftl文件提供了前端布局定制功能：</p><pre tabindex=0><code>&lt;#--
使用者可以通过覆盖这个文件实现对一些宏的重新定义包括：
--html head中的内容，包括css meta等
&lt;#macro mower_front_head title = &#39;&#39;&gt;
--页面的最上端
&lt;#macro mower_front_header_login&gt;
--广告
&lt;#macro mower_front_header_ad&gt;
--LOGO
&lt;#macro mower_front_header_logo&gt;
--菜单栏
&lt;#macro mower_front_header_menu&gt;
--页脚
&lt;#macro mower_front_footer&gt;
--包含的Javascript(angularjs,knockoutjs,datagrid)
&lt;#macro mower_front_scripts require = &#39;&#39;&gt;
--&gt;


&lt;#--
局部替换：如果以下变量定义在具体业务模板中，则会覆盖你的layout模板中的定义

-- 定义最顶的登录状态条最左边显示的文字内容
&lt;#global mower_front_header_login_custom_left&gt;
    文字
&lt;/#global&gt;

-- 定义最顶的登录状态条最右边显示的文字内容
&lt;#global mower_front_header_login_custom_right&gt;
    &lt;li&gt;
        &lt;a target=&#34;_blank&#34; href=&#34;#&#34;&gt;&lt;i class=&#34;fa fa-sitemap&#34;&gt;&lt;/i&gt;网站导航&lt;/a&gt;
    &lt;/li&gt;
&lt;/#global&gt;

定制广告头
&lt;#global mower_front_header_ad_custom&gt;

&lt;/#global&gt;

定制LOGO区域
&lt;#global mower_front_header_logo_custom&gt;

&lt;/#global&gt;

定制整个菜单区域
&lt;#global mower_front_header_menu_custom&gt;
xxxxx
&lt;/#global&gt;

定制默认菜单的右边区域
&lt;#global mower_front_header_menu_custom_right&gt;
    &lt;li&gt;&lt;a href=&#34;xxx&#34;&gt;xxx&lt;/a&gt;&lt;/li&gt;
&lt;/#global&gt;

定制页脚区域
&lt;#global mower_front_footer_custom&gt;
ddddadf
&lt;/#global&gt;

&lt;#global mower_front_scripts_addition&gt;
    加入你自己的javascript库文件
&lt;/#global&gt;

&lt;#global mower_front_head_addition&gt;
    加入你自己的css文件
&lt;/#global&gt;
--&gt;
</code></pre><h3 id=ui宏>UI宏</h3><p>u目录的ui.ftl提供了框架默认的UI宏，包括：</p><pre tabindex=0><code>&lt;#-- UI的自定义宏 --&gt;
&lt;#---------------------------------------ADMIN---------------------------------------&gt;
&lt;#macro panel id=&#39;panel-list&#39; class=&#39;panel panel-widget unboxed&#39;&gt;

&lt;/#macro&gt;

&lt;#macro panel_head&gt;

&lt;/#macro&gt;

&lt;#macro panel_body&gt;

&lt;/#macro&gt;

&lt;#macro panel_footer&gt;

&lt;/#macro&gt;

&lt;#macro panel_toolbar_query&gt;

&lt;/#macro&gt;

&lt;#macro panel_toolbar_advanced_query&gt;

&lt;/#macro&gt;
&lt;#------------------------------FRONT-------------------------------------&gt;
&lt;#macro main_breadcrumb rootType = &#39;admin&#39; menuCode = &#39;&#39;&gt;
&lt;!-- BEGIN BREADCRUMB --&gt;

&lt;!-- END BREADCRUMB--&gt;
&lt;/#macro&gt;

&lt;#macro main_sidebar&gt;

&lt;/#macro&gt;

&lt;#macro main_content&gt;

&lt;/#macro&gt;

&lt;#macro main_wrapper&gt;

&lt;/#macro&gt;
&lt;#----------------------------------------COMMON---------------------------------&gt;
&lt;#include &#34;/ui/app/ui.ftl&#34; /&gt;
</code></pre><p>典型的后端页面是：</p><pre tabindex=0><code>&lt;@layout.mower_admin title=&#39;&#39; scripts=&#39;&#39;&gt;
&lt;@ui.panel&gt;
    &lt;@ui.panel_head&gt;
    工具条
    &lt;/@ui.panel_head&gt;
    &lt;@ui.panel_body&gt;
    内容
    &lt;/@ui.panel_body&gt;
&lt;/@ui.panel&gt;
&lt;/@layout.mower_admin&gt;
</code></pre><p>典型的前端页是：</p><pre tabindex=0><code>&lt;@layout.mower_front title=&#34;Dashboard&#34;&gt;
    &lt;@ui.main_breadcrumb rootType=&#39;front&#39; menuCode=&#34;FRONT_TEST_MENU1&#34; /&gt;
    &lt;@ui.main_wrapper&gt;
        &lt;@ui.main_content&gt;
            Dashborad
        &lt;/@ui.main_content&gt;
    &lt;/@ui.main_wrapper&gt;
&lt;/@layout.mower_front&gt;
</code></pre><p>你可以覆盖ui/app/ui.ftl和ui.js来定义你的UI宏。</p><h4 id=高级查询自动关联>高级查询自动关联</h4><p>这个以一个例子来说明。如下图所示，有一个根据名称和编码的快捷查询，在其右侧还有一个高级查询，点击高级查询按钮，dropdown里面的查询条件更丰富一些。用户在快捷查询中的名称、编码填了内容后，发现当前条件还没能筛选出满意的内容，当他点击高级查询时，在高级查询dropdown里的相应字段（菜单名称、编码）的内容会用快捷查询的相应内容自动填充，并把它们的值关联起来。</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/advquery-004.png><img src=/docs/imgs/v3.1/chapter2/advquery-004.png alt></a></p><p>这个主要是通过框架中定义的panel_toolbar_query和panel_toolbar_advanced_query这两个宏实现的。两个宏中的input元素通过id进行value的关联。程序会遍历panel_toolbar_query中的input元素的id，然后在panel_toolbar_advanced_query找到前缀为advanced_query_相应的id进行关联。如下例中的id分别为“name”和“advanced_query_name”的两个元素。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#a40000>&lt;</span>@ui.panel_toolbar_query&gt;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-inline&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>编码<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;#&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;search-submit-action-${code}&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;btn btn-default btn-sm&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;fa fa-search&#34;</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>i</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_query&gt;
</span></span><span style=display:flex><span><span style=color:#a40000>&lt;</span>@ui.panel_toolbar_advanced_query&gt;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-horizontal&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-advanced-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-body&#34;</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;width: 420px; height: 280px; padding: 10px 30px 0 0; text-align: right;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group row&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;col-md-4&#34;</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;padding-top: 5px&#34;</span><span style=color:#000;font-weight:700>&gt;</span>菜单名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;col-md-8&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span>  <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control input-sm&#34;</span> <span style=color:#c4a000>maxlength</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;50&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;advanced_query_name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span><span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_advanced_query&gt;
</span></span></code></pre></div><p>另外，panel_toolbar_advanced_query有个参数“customDivId”,可以让我们把高级查询的内容放到一个自定义的div里而不是默认的dropdown中，当点击“高级查询”时div会自动toggle，相应的字段也会关联。</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/advquery-005.png><img src=/docs/imgs/v3.1/chapter2/advquery-005.png alt></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class </span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;row&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#a40000>&lt;</span>@ui.panel_toolbar_query&gt;
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-inline&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-search&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>名称<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>label</span> <span style=color:#c4a000>style</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;color: #333;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>编码<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>label</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;input-sm form-control&#34;</span> <span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;#&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;search-submit-action-${code}&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;btn btn-default btn-sm&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;fa fa-search&#34;</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>i</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_query&gt;
</span></span><span style=display:flex><span>        <span style=color:#a40000>&lt;</span>@ui.panel_toolbar_advanced_query customDivId=&#34;myDiv&#34;&gt;
</span></span><span style=display:flex><span>        <span style=color:#a40000>&lt;</span>/@ui.panel_toolbar_advanced_query&gt;
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;myDiv&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span>…
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h2 id=前端开发框架>前端开发框架</h2><p>Macula 使用 Mower 作为前端开发框架。有关 Mower 的详细介绍请访问 <a href=http://macula.top/mower/>Mower 官方网站</a>。</p><h2 id=macula宏>Macula宏</h2><p>为了方便开发，框架内置了一些常用的macula宏给freemarker使用</p><h3 id=权限判断>权限判断</h3><p>在freemarker中，如果需要通过权限控制是否显示内容，如下：</p><pre tabindex=0><code>&lt;@macula.preAuthorized url method&gt;
有权限的显示
&lt;/@macula.preAuthorized&gt;
&lt;@macula.notAuthorized url method&gt;
没有权限的显示
&lt;/@macula.notAuthorized&gt;
</code></pre><h3 id=下拉框>下拉框</h3><p>我们先来看看Macula中下拉框的样子，如下图绿色方框中所示：</p><p><a data-fancybox=gallery href=/docs/imgs/v3.1/chapter2/macula_select.png><img src=/docs/imgs/v3.1/chapter2/macula_select.png alt=macula_select></a></p><p>要实现下拉框首先需要有下拉框选项。下拉框的选项是静态的情形很简单，在这里我们讨论的是下拉框中的选项是从数据库中获取的。我们知道下拉框的选项由 name 和 value两项组成。在这里，我们需要用到 Macula 的数据参数功能。我们可以在数据参数中定义这些选项。数据参数中定义的选项有三种形式。</p><ol><li><p>典型的形式如下：</p><pre tabindex=0><code>name1:value1|name2:value2|...
</code></pre><p>例如：</p><pre tabindex=0><code>NONE:不缓存|SESSION:整个用户Session作用域|INSTANCE:实例级作用域|APPLICATION:全局级别作用域
</code></pre></li><li><p>如果选项的 name 和 value 相同，还可以简化成以下的形式：</p><pre tabindex=0><code>name1|name2|...
</code></pre><p>例如：</p><pre tabindex=0><code>String|Integer|Long|Double|Boolean|Timestamp|Date|Word
</code></pre></li><li><p>当然还可以用 SQL 的形式从数据库中获取。例如：</p><pre tabindex=0><code>!select app_name as label, app_id as code from ma_base_application
</code></pre></li></ol><p>有关数据参数的详细介绍，请参阅“基础插件”中的“数据提供”一节。</p><p>下面我们来看下如何在 ftl 中定义下拉框：</p><pre tabindex=0><code>&lt;div class=&#34;form-group&#34;&gt;
    &lt;label class=&#34;control-label col-md-3&#34;&gt;所属应用：&lt;/label&gt;
    &lt;div class=&#34;col-md-9&#34;&gt;
        &lt;select name=&#34;dataParam.appId&#34; data-bind=&#34;options: appIdParams.application_list, optionsText: &#39;label&#39;, optionsValue:&#39;code&#39;, optionsCaption: &#39;请选择&#39;, value: appId &#34;  class=&#34;chosen-select form-control&#34;/&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre><p>上面的例子中用到了 knockoutJs 的 data-bind，通过 options 属性将一个名为 appIdParams.application_list 的 js 变量绑定到下拉框的选项中，而 appIdParams.application_list 中的内容正是来自于预先定义好的数据参数 application_list。在同一个 ftl 中我们使用 Macula 框架提供的宏 writeDataParamsJs 获取数据参数 application_list 的内容。如下：</p><pre tabindex=0><code>&lt;script type=&#34;text/javascript&#34;&gt;
    var appIdParams={&lt;@macula.writeDataParamsJs &#39;application_list&#39; /&gt;};
&lt;/script&gt;
</code></pre><p>数据参数 application_list 的定义如下：</p><pre tabindex=0><code>select app_name as label, app_id as code from ma_base_application
</code></pre><p><em><strong>提示：</strong></em></p><p><em><strong>&lt;@macula.writeDataParamsJs &lsquo;xxx&rsquo;/>可以通过逗号分隔多个参数，如果同一个界面有多个参数可以通过这种方式一次获取参数。</strong></em></p><h3 id=避免重复提交的token>避免重复提交的Token</h3><pre tabindex=0><code>&lt;@macula.formToken captcha=&#34;true/false&#34; /&gt;
</code></pre><p>上述代码放入表单中，则会自动生成防止重复提交的token，如果要显示验证码，captcha输入true。</p><h2 id=freemarker内置变量>FreeMarker内置变量</h2><p>macula框架通过扩展freemarker提供了一些内置变量和方法给Freemarker模板使用。</p><h3 id=登录用户信息>登录用户信息</h3><p>变量userPrincipal：代表用户登陆后的凭据。</p><p>登录用户信息在登录时，我们可以通过实现 CustomUserLoginRepository 接口把用户信息放到UserPincipal的atrribute中，可以在Freemarker中通过如下获取，Freemaker中的userPrincipal对应UserPrincipal类：</p><pre tabindex=0><code>&lt;#if userPrincipal.getAttributeValue(&#34;userInfo&#34;)?exists&gt;
  &lt;#assign userInfo = userPrincipal.getAttributeValue(&#34;userInfo&#34;)&gt;
&lt;/#if&gt;

&lt;#if userInfo?exists&gt;

&lt;#else&gt;

&lt;/#if&gt;

&lt;!--当前用户名--&gt;
${userPrincipal.getName()！&#34;&#34;}
&lt;!--当前用户姓名--&gt;
${userPrincipal.getNickname()!&#34;&#34;}
</code></pre><h3 id=菜单变量>菜单变量</h3><p>macula框架在Freemarker中默认有如下变量：</p><ul><li><p>后端</p><ul><li><p>adminRootMenu ：后端根菜单</p></li><li><p>adminMainMenu：父亲是根的二级菜单</p></li></ul></li><li><p>前端</p><ul><li><p>frontRootMenu：前端根菜单</p></li><li><p>frontMainMenu：父亲是根的二级菜单</p></li></ul></li><li><p>移动端</p><ul><li><p>mobileRootMenu：移动端根菜单</p></li><li><p>mobileMainMenu：父亲是根的二级菜单</p></li></ul></li></ul><p>获取绝对地址方法</p><h3 id=freemarker内置方法>Freemarker内置方法</h3><ul><li><p>getDataParams(dataParamCode) 返回FieldOption类型的code/value参数列表；</p></li><li><p>getMenuBreadcrumb(rootType, menuCode) 返回指定菜单的面包屑结构菜单，参考ui宏</p></li><li><p>hasAccess(url, method) 返回指定的url和method是否可以访问</p></li><li><p>getAbsoluteUrl(base, url, default) 返回url的绝对路径，如果url不是以http/https开头，会自动加上base</p></li></ul><h2 id=国际化>国际化</h2><p>国际化 可分为页面国际化和提示信息国际化。</p><p>页面国际化可以通过多个Freemarker文件解决，通过不同的国际化后缀来区分不同地区的页面；比如：index.ftl，如果要添加一个英文页面，可以添加index_en_US.ftl，这样当英文国家的用户访问系统时，将最先使用index_en_US.ftl文件。</p><p>提示信息国际化使用资源文件处理，在每个模块的资源文件目录下，都有i18n/xxxx/messages_xx_XX.properties等众多资源文件，同时添加到applicationContext-app.xml配置文件中。</p><h2 id=地址规划>地址规划</h2><p>对于当前大部分的业务系统，存在终端使用和后台管理的情况以及未来对于F5在地址分发方面的合理性布局，在地址规划上，需要按一定的规则进行：</p><ul><li>/admin ：如果该功能是一个后台管理功能，则需要在地址前端加入/admin</li><li>/front：如果该功能是一个用户使用功能，则需要在地址前端加入/front/</li><li>/模块名/：针对macula平台开发的需要，每个模块都必须有自己的地址命名空间，对于该部分的命名，需要在模块定义规划时指定（具体的模块命名可能需要进行流程方面的审批）。</li><li>/功能名称/：针对模块下的某一功能，需要给出功能的名称。</li><li>/操作名称/：针对某一功能下具体的操作，需要给出操作的名称，如index,new,edit,save,read,delete,query等动词。</li></ul><p>所以最终的地址命名为：</p><ul><li>管理功能：/admin/模块名/功能名/操作名称/参数/其他</li><li>用户功能：/front/模块名/功能名/操作名称/参数/其他</li></ul><h2 id=请求方式规划>请求方式规划</h2><p>为了保证业务系统不被重复的请求以及不正确的请求干扰，对于请求方式做如下规划：</p><ul><li>对于获取单条数据或显示新增与编辑页面的方式可以使用GET请求</li><li>对于删除数据、保存数据或提交多条数据给后台的应该使用POST方式</li><li>有多个查询条件的查询功能应该使用POST方式</li></ul><h2 id=restful-api>RESTful API</h2><p>在对REST的支持方面，使用Spring的REST解决方案，macula平台提供@OpenApi注解替换@ResponseBody注解，这里说明在能使用REST的方式下，尽量使用REST方式。</p><p>在Macula平台开发中，将不通过地址中的参数来传递参数值，而直接通过地址信息来传递参数值。</p><p>如请求的地址：/admin/macula-uim/user/delete/user1 可通过Controller中定义</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RequestMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/admin/macula-uim/user/delete/{userName}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>method</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RequestMethod</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DELETE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@OpenApi</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExecuteResponse</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@PathVariable</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>//do something
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=rest数据返回格式>REST数据返回格式</h3><p>为了未来能够将目前的Controller请求方法开放给其他终端使用，有必要对Controller的返回值做一个统一的规划，如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 是否成功标识 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>success</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 系统级错误代码 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>errorCode</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 系统级错误信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>errorMessage</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 业务级错误代码 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionCode</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 业务级错误信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionMessage</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 异常详细信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>exceptionStack</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 服务端重定向信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>redirection</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 校验结果信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>FieldError</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>validateErrors</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Response</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>success</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Response</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>MaculaException</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>success</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>errorCode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getParentCode</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>errorMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ApplicationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>errorMessage</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionCode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLocalizedMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exceptionStack</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getFullStackMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>exception</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>FieldError</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>fieldErrors</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>FormBindException</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getFieldErrors</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>FieldError</span> <span style=color:#000>fieldError</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>fieldErrors</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addValidateError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>fieldError</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ExecuteResponse</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 结果信息 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>T</span> <span style=color:#000>returnObject</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExecuteResponse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>returnObject</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * @return the result
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>T</span> <span style=color:#000>getReturnObject</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>returnObject</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>PageResponse</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Response</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 本次请求的记录数 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>size</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 当前页码，从零开始 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 总记录数 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>totalElements</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 总页数 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>totalPages</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 本页的总记录数 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>numberOfElements</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 是否首页 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>firstPage</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 是否最后页 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>lastPage</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** 内容列表 */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?&gt;</span> <span style=color:#000>content</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>PageResponse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;?&gt;</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSize</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getNumber</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>totalElements</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTotalElements</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>totalPages</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTotalPages</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>numberOfElements</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getNumberOfElements</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>firstPage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isFirstPage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>lastPage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isLastPage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>content</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>page</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getContent</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>上述代码中，Response类是基类，出现异常时会构造Response类型返回，ExecuteResponse主要用在单记录数据的返回，PageResponse则用于需要返回列表数据的情况。</p><p><em><strong>重要</strong></em></p><p><em>为了减少对编程的干扰，正常情况下，Controller中的方法可以仍然按照Service接口中的方法的返回值正常返回数据，对于原使用@ResponseBody注解的方法，如果需要，则通过使用@OpenApi注解来自动处理对应的返回值，默认情况下，采用@OpenApi 注解后，非Response、Map、Model等类型的返回值，会被包裹成ExecuteResponse，而Page&lt;?>返回值会被包裹成PageResponse。</em></p><p>@OpenApi注解的启用需要配置RequestMappingHandlerAdapter的customReturnValueHandlers属性：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customReturnValueHandlers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.macula.core.mvc.OpenApiReturnValueHandler&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;messageConverters&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>              
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span></code></pre></div><h2 id=heading></h2><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5 polaris-main-link-btn-group"><li><a href=/docs/v3.1/chapter2/04_service/ aria-label="上一篇 - 业务服务层" class=btn-grey><span class=mr-1>←</span>上一篇</a></li><li><a href=/docs/v3.1/chapter2/06_timezone/ aria-label="下一篇 - 时间设置" class=btn-grey>下一篇<span class=ml-1>→</span></a></li></ul></div><script src=/js/backtop.js></script>
<script>addBackToTop({diameter:56,backgroundColor:"rgb(208,204,204)",textColor:"#000000"})</script></main></div></div><script src=/js/jquery.fancybox.min.js></script>
<script src=/js/jquery.min.js></script>
<link rel=stylesheet href=/css/jquery.fancybox.min.css><div class=polaris-footer><span>@ 2022 The PolarisMesh Authors</span>
<span class=high-resolution>|</span>
<span>A Tencent Microservice Project</span>
<a href=https://beian.miit.gov.cn/#/Integrated/index>粤B2-20090059</a><div class=polaris-footer-background></div></div></div><script src=/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>